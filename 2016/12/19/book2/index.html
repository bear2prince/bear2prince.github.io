<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>book2</title>

	<link rel="shortcut icon" href="/styles/images/favicon.jpg">
	<link rel="icon" href="/styles/images/favicon.jpg">

	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="canonical" href="/2016/12/19/book2/">
	<link rel="alternate" type="application/rss+xml" title="bear2prince" href="/feed.xml">
	
	<meta name="description" content="个人博客;学而不思则罔;思而不学则殆;生命不止;折腾不休">

	<script src="/styles/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?94be4b0f9fc5d94cc0d0415ea6761ae9";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
  	<style type="text/css">
	  	.docs-content{
	  		margin-bottom: 10px;
	  	}
  	</style>
</head>

  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo.jpg">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/categories/">大类分解</a>
        </li>
        <li>
          <a href="/tag">小类内聚</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/donate/"><strong>打赏</strong></a>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">关于<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a rel="nofollow" target="_blank" href="https://bear2prince.github.io">Github</a></li>
            <li><a rel="nofollow" target="_blank" href="https://bear2prince.github.io">关于作者</a></li>
            <li><a rel="nofollow" href="/books">我的书单</a></li>
            <li><a rel="nofollow" href="/reference">推荐博客</a></li>
            <li><a href="/feed.xml">RSS订阅</a></li>
            <li class="divider"></li>
            <li><a rel="nofollow" target="_blank" href="https://github.com/luoyan35714/LessOrMore.git">本项目</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>
<link rel="stylesheet" href="/styles/css/prism.css">
<script src="/styles/js/prism.js"></script>

    <div class="docs-header" id="content">
  <div class="container">
  	
  		<!--
		    <h1>book2</h1>
		    <p>Post on Dec 19, 2016 by <a href="/about">bear2prince</a></p>
		-->
		    <h1>It's our wits that make us men.</h1>
    
  </div>
</div>
    
      
<div class="banner">
  <div class="container">
  	
    	<a href="/categories/#document-ref">document</a>	/
    	<a href="/tag/#教程-ref">教程</a>
    
  </div>
</div>

    

    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
<!--
    
      
      
      
      

      
        <li><a href="#year_2016">2016</a>
          <ul class="nav">
            <li><a href="#month_2016_December">December</a></li>
      

      
            
          
        
      
    
      
      
      
      

      

      
            </ul>
          </li>
      
    
-->
  </ul>
</div>
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">book2</h1>
              <!--
                <p class="post-meta">Dec 19, 2016</p>
              -->
              <div class="meta">Posted on <span class="postdate">Dec 19, 2016</span> By <a target="_blank" href="http://localhost:4000">bear2prince</a></div>
              <br />
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#chapter3-3" id="markdown-toc-chapter3-3">chapter3 3.</a></li>
  <li><a href="#chapter4-3" id="markdown-toc-chapter4-3">chapter4 3.</a></li>
  <li><a href="#chapter5-2" id="markdown-toc-chapter5-2">chapter5 2.</a></li>
  <li><a href="#chapter5-2-keng" id="markdown-toc-chapter5-2-keng">chapter5 2. Keng</a></li>
  <li><a href="#chapter5-2-1" id="markdown-toc-chapter5-2-1">chapter5 2.</a></li>
  <li><a href="#chapter5-2-keng-1" id="markdown-toc-chapter5-2-keng-1">chapter5 2. Keng</a></li>
  <li><a href="#chapter5-2-keng-2" id="markdown-toc-chapter5-2-keng-2">chapter5 2. Keng</a></li>
  <li><a href="#chapter5-4" id="markdown-toc-chapter5-4">chapter5 4.</a></li>
</ul>

<h2 id="chapter3-3">chapter3 3.</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'aepofi'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">bar</span><span class="p">();</span><span class="c1">//Uncaught ReferenceError: bar is not defined</span></code></pre></figure>

<p>目的：</p>

<ul>
  <li>
    <p>辨别function declaration与function expression：”The easiest way to distinguish declaration vs. expression is the position of the word “function” in the statement (not just a line, but a distinct statement). If “function” is the very first thing in the statement, then it’s a function declaration. Otherwise, it’s a function expression.”</p>
  </li>
  <li>
    <p>记忆function declaration与function expression函数名的存放位置：”the name of function declaration is bound in the enclosing scope，the name of function expression is not bound in the enclosing scope, but instead is bound only inside of its own function.”</p>
  </li>
</ul>

<p>本例中，<code class="highlighter-rouge">function bar()</code>并不在代码的行首，所以<code class="highlighter-rouge">function bar()</code>是function expression，其函数”bar”名储存在自己的scope中，在global scope中无法找到”bar”,所以执行到bar()时报ReferenceError。</p>

<h2 id="chapter4-3">chapter4 3.</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// 3</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">foo</span><span class="p">();</span> <span class="c1">// 3</span>

<span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>目的：</p>

<ul>
  <li>理解function declarations和variable declarations被hoisted时的优先级：”Both function declarations and variable declarations are hoisted. But a subtle detail is that functions are hoisted first, and then variables.”</li>
  <li>理解声明同名函数时发生覆盖：”subsequent function declarations do override previous ones”</li>
</ul>

<p>本例中，有两个function declarations和一个variable declaration，它们的名字都是foo。对于两个同名函数<code class="highlighter-rouge">foo()</code>，后声明的<code class="highlighter-rouge">foo()</code>会覆盖先声明的。此外，”var foo was the duplicate (and thus ignored) declaration, because function declarations are hoisted before normal variables”。综上，执行<code class="highlighter-rouge">foo()</code>时，输出3（最后一个<code class="highlighter-rouge">foo()</code>的执行结果）。</p>

<h2 id="chapter5-2">chapter5 2.</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// ---------- Closure -----------</span>
<span class="kd">function</span> <span class="nx">foo1</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">bar</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">foo1</span><span class="p">()</span>

<span class="nx">a</span><span class="p">();</span><span class="c1">//3</span></code></pre></figure>

<p>目的：弄清楚此处bar()是否有closure</p>

<p>本例中，bar()并没有closure，因为<code class="highlighter-rouge">bar()</code>中调用的参数a为自身scope中声明的变量a，而非其immediate enclosing scope <code class="highlighter-rouge">foo1()</code>中的变量a，所以<code class="highlighter-rouge">bar()</code>没有closure。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo2</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">a</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">foo2</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="c1">//3，bar()函数有closure，其中包含foo2()中的a = 3。</span></code></pre></figure>

<p>目的：理解只要inner function调用enclosing scope（除global scope）中的参数，就会生成closure，无论inner function是否被调用。</p>

<p>本例中，虽然<code class="highlighter-rouge">bar()</code>没有被调用，但是由于其在声明时调用了其enclosing scope（foo2()）中的参数a，<code class="highlighter-rouge">bar()</code>便生成一个closure（foo2）。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo3</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">let</span> <span class="nx">aa</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">fooo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

        <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aa</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">bar</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">fooo</span><span class="p">()</span>
    <span class="nx">a</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">foo3</span><span class="p">();</span><span class="c1">//3 4</span></code></pre></figure>

<p>目的：理解inner function调用immediate enclosing scope上层scope中的参数时，会形成该scope的closure。</p>

<p>本例中，由于<code class="highlighter-rouge">bar()</code>调用了<code class="highlighter-rouge">foo3()</code>scope中的参数aa，所以<code class="highlighter-rouge">bar()</code>生成closure（foo3）。此外，<code class="highlighter-rouge">fooo()</code>也生成了closure（foo3）。</p>

<h2 id="chapter5-2-keng">chapter5 2. Keng</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Keng:</span>
<span class="kd">var</span> <span class="nx">aa</span> <span class="o">=</span> <span class="mi">4</span>

<span class="kd">function</span> <span class="nx">foo4</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aa</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">bar</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">foo4</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">3</span>

<span class="nx">a</span><span class="p">()</span><span class="c1">//4</span></code></pre></figure>

<p>目的：理解当函数调用global scope（也是一种enclosing scope）中的参数时，不会生成closure。</p>

<p>本例中，<code class="highlighter-rouge">a()</code>的执行结果是输出4，虽然其调用了enclosing scope（global scope）中的参数aa，但是<code class="highlighter-rouge">a()</code>并未生成closure。</p>

<h2 id="chapter5-2-1">chapter5 2.</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Immediate Enclosing Scope</span>
<span class="kd">function</span> <span class="nx">foo5</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">bb</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="kd">function</span> <span class="nx">baz</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span> <span class="c1">//2</span>
    <span class="p">}</span>
    <span class="nx">bar1</span><span class="p">(</span><span class="nx">baz</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">bar1</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">fn</span><span class="p">();</span> <span class="c1">// look ma, I saw closure!</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo5</span><span class="p">();</span><span class="c1">//2</span></code></pre></figure>

<p>此例中，因为<code class="highlighter-rouge">baz()</code>调用了enclosing scope（foo5）中的参数a，所以<code class="highlighter-rouge">baz()</code>生成了一个closure（foo5）。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo6</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span> <span class="c1">// 2</span>
    <span class="p">}</span>
    <span class="nx">bar</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">foo6</span><span class="p">();</span><span class="c1">// 2 4</span></code></pre></figure>

<p>目的：理解只要inner function调用enclosing scope（除global scope）中的参数，就会生成closure，尽管inner function只在其enclosing scope中被调用。</p>

<p>此例中，由于<code class="highlighter-rouge">bar()</code>调用了enclosing scope（foo6）中的参数a，<code class="highlighter-rouge">bar()</code>生成closure（foo6），尽管<code class="highlighter-rouge">bar()</code>只在其immediate enclosing scope中被调用。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo7</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">aaa</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">baaz</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa</span><span class="p">);</span> <span class="c1">// 2</span>
        <span class="nx">aaa</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">bar</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span><span class="c1">//</span>
    <span class="p">{</span>
        <span class="nx">fn</span><span class="p">();</span> <span class="c1">// look ma, I saw closure!</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">bar</span><span class="p">(</span><span class="nx">baaz</span><span class="p">);</span><span class="c1">//2</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa</span><span class="p">)</span><span class="c1">//10</span>
    <span class="nx">baaz</span><span class="p">()</span><span class="c1">//10</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa</span><span class="p">)</span><span class="c1">//10</span>
    <span class="kd">var</span> <span class="nx">bb</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo7</span><span class="p">()</span></code></pre></figure>

<p>目的：理解内层函数的closure就是其对应生成closure外层函数的scope，当外层函数scope中的变量发生变化时，内层函数的closure中的变量也会随之改变。</p>

<p>本例中，<code class="highlighter-rouge">baaz()</code>有closure（foo7），当第一次执行到<code class="highlighter-rouge">console.log(aaa)</code>时，由于foo7 scope中的变量aaa为2，所以<code class="highlighter-rouge">console.log(aaa)</code>输出2。当执行的<code class="highlighter-rouge">aaa = 10</code>时，foo7 scope中的变量aaa被修改为10，随之<code class="highlighter-rouge">baaz()</code>的closure（foo7）中的aaa值也变为10。所以当代码执行到<code class="highlighter-rouge">baaz()</code>，输出结果为10。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo8</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">aaa</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">baaz</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa</span><span class="p">);</span> <span class="c1">// 2</span>
        <span class="nx">aaa</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">baaz</span><span class="p">();</span> <span class="c1">// look ma, I saw closure!</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">bar</span><span class="p">()</span><span class="c1">//2</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa</span><span class="p">)</span> <span class="c1">//10</span>
    <span class="nx">baaz</span><span class="p">()</span><span class="c1">//10</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa</span><span class="p">)</span><span class="c1">//10</span>
    <span class="kd">var</span> <span class="nx">bb</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo8</span><span class="p">()</span></code></pre></figure>

<p>此函数于foo7等价</p>

<h2 id="chapter5-2-keng-1">chapter5 2. Keng</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Keng: Scope doesn't exist</span>
<span class="kd">var</span> <span class="nx">aaa10</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">func10</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">IIFE</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="kd">var</span> <span class="nx">bbb</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">pafeij</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa10</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa10</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">func10</span><span class="p">();</span></code></pre></figure>

<p>目的：理解function expression的scope存在，但是在其immediate enclosing scope中看不见</p>

<p>此例中，IIFE为function expression，其scope可以通过加断点进入，但是无法在global scope中观测到。同理，进入IIFE的scope后，我们也无法观测pafeij（function expression）的scope。</p>

<h2 id="chapter5-2-keng-2">chapter5 2. Keng</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo7</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">function</span> <span class="nx">bar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">bar</span><span class="p">();</span><span class="c1">//4 只要一个有closure，剩下都有closure</span>

    <span class="kd">function</span> <span class="nx">baaz</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aaa</span><span class="p">);</span>    
    <span class="p">}</span>
    <span class="kd">let</span> <span class="nx">aaa</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nx">baaz</span><span class="p">();</span><span class="c1">//2</span>
<span class="p">}</span>
<span class="nx">foo7</span><span class="p">()</span></code></pre></figure>

<p>目的：</p>

<ul>
  <li>理解<code class="highlighter-rouge">console.log(aaa)</code>处为什么不报错（编译时不报referenceError，执行的时候报）</li>
  <li>一个inner function有closure，其余的inner functions都有closure</li>
  <li>弄清closure的形成时间</li>
</ul>

<p>本例中，编译到<code class="highlighter-rouge">console.log(aaa)</code>时，虽然aaa还没有被声明，但是不会报错。只要在执行<code class="highlighter-rouge">console.log(aaa)</code>前，aaa被声明，执行<code class="highlighter-rouge">console.log(aaa)</code>时不会报referenceErro错误。但是如果<code class="highlighter-rouge">console.log(aaa)</code>执行前，aaa未被声明（如将<code class="highlighter-rouge">let aaa = 2;</code>与<code class="highlighter-rouge">baaz();</code>两行代码调换位置），则会报referenceErro错误。</p>

<p>其次，本例中虽然<code class="highlighter-rouge">bar()</code>没有调用enclosing scope中的变量，但也形成了closure（foo7）。也就是说只要一个inner function有closure（<code class="highlighter-rouge">baaz()</code>中使用了enclosing scope中的变量），那么其余的inner functions都会有closure。</p>

<p>最后，在<code class="highlighter-rouge">bar();</code>处添加断点（此时<code class="highlighter-rouge">baaz();</code>并未执行），我们发现<code class="highlighter-rouge">bar();</code>有closure（foo7），且由上一点我们知道，<code class="highlighter-rouge">bar()</code>有closure是因为<code class="highlighter-rouge">baaz()</code>生成了closure，说明现在，在<code class="highlighter-rouge">baaz()</code>未被执行的时候，<code class="highlighter-rouge">baaz()</code>已经生成了closure，说明closure是在编译的时候生成的。</p>

<h2 id="chapter5-4">chapter5 4.</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span>
    <span class="p">},</span> <span class="nx">i</span><span class="o">*</span><span class="mi">1000</span> <span class="p">);</span>
<span class="p">}</span>
<span class="o">-----------</span><span class="err">等价写法</span><span class="o">-----------</span>
<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nx">i</span><span class="o">++</span>
<span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span> <span class="p">},</span> <span class="nx">i</span><span class="o">*</span><span class="mi">1000</span> <span class="p">);</span>
<span class="nx">i</span><span class="o">++</span>
<span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span> <span class="p">},</span> <span class="nx">i</span><span class="o">*</span><span class="mi">1000</span> <span class="p">);</span>
<span class="nx">i</span><span class="o">++</span>
<span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span> <span class="p">},</span> <span class="nx">i</span><span class="o">*</span><span class="mi">1000</span> <span class="p">);</span>
<span class="nx">i</span><span class="o">++</span>
<span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span> <span class="p">},</span> <span class="nx">i</span><span class="o">*</span><span class="mi">1000</span> <span class="p">);</span>
<span class="nx">i</span><span class="o">++</span>
<span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span> <span class="p">},</span> <span class="nx">i</span><span class="o">*</span><span class="mi">1000</span> <span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'japoweijfopaijwe'</span><span class="p">)</span>
<span class="c1">//japoweijfopaijwe</span>
<span class="c1">//6 间隔1000毫秒</span>
<span class="c1">//6 间隔1000毫秒</span>
<span class="c1">//6 间隔1000毫秒</span>
<span class="c1">//6 间隔1000毫秒</span>
<span class="c1">//6 间隔1000毫秒</span></code></pre></figure>

<p>由于<code class="highlighter-rouge">function timer()</code>没有形成closure，所以输出结果均为6。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">---------</span> <span class="nx">iife</span> <span class="nx">implementation</span> <span class="o">---------</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="kd">function</span> <span class="nx">iife</span><span class="p">(</span><span class="nx">j</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">j</span> <span class="p">);</span> <span class="p">},</span> <span class="mi">1000</span> <span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'pajeopifaj'</span><span class="o">+</span><span class="nx">i</span><span class="p">)</span>
    <span class="p">})(</span><span class="nx">i</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>The use of an IIFE inside each iteration created a new scope for each iteration, which gave our
timeout function callbacks the opportunity to close over a new scope for each iteration, one which had a variable with the right per-iteration value in it for us to access.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//--------- setTimeout 在for 循环结束后才执行 ---------</span>
<span class="kd">function</span> <span class="nx">waitSeconds</span><span class="p">(</span><span class="nx">iMilliSeconds</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">counter</span><span class="o">=</span> <span class="mi">0</span>
        <span class="p">,</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
        <span class="p">,</span> <span class="nx">end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">counter</span> <span class="o">&lt;</span> <span class="nx">iMilliSeconds</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">end</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
        <span class="nx">counter</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span> <span class="nx">timer</span><span class="p">(){</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">i</span> <span class="p">);</span> <span class="p">},</span> <span class="mi">1000</span> <span class="p">);</span>
     <span class="nx">waitSeconds</span><span class="p">(</span><span class="mi">1001</span><span class="p">)</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'pajeopifaj'</span><span class="o">+</span><span class="nx">i</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'ajofpewijfopaej'</span><span class="p">)</span>
<span class="c1">//pajeopifaj1 间隔1001毫秒</span>
<span class="c1">//pajeopifaj2 间隔1001毫秒</span>
<span class="c1">//pajeopifaj3 间隔1001毫秒</span>
<span class="c1">//pajeopifaj4 间隔1001毫秒</span>
<span class="c1">//pajeopifaj5 间隔1001毫秒</span>
<span class="c1">//ajofpewijfopaej 瞬间</span>
<span class="c1">//1 瞬间</span>
<span class="c1">//2 瞬间</span>
<span class="c1">//3 瞬间</span>
<span class="c1">//4 瞬间</span>
<span class="c1">//5 瞬间</span></code></pre></figure>

<p>目的：理解setTimeout函数及参数（函数）的执行时间</p>

<p>此例中，<code class="highlighter-rouge">waitSeconds(1001)</code>的目的在于延长for循环执行时间（1001毫秒），观测<code class="highlighter-rouge">setTimeout</code>及其参数（<code class="highlighter-rouge">function timer()</code>）的执行时间。由执行结果可以看出，<code class="highlighter-rouge">function timer()</code>中的<code class="highlighter-rouge">console.log( i )</code>在整个主进程执行结束之后才执行。</p>

<p>此外，由于<code class="highlighter-rouge">function timer()</code>的执行结果瞬间被弹出，说明<code class="highlighter-rouge">setTimeout</code>进程在主进程执行<code class="highlighter-rouge">setTimeout</code>函数时便被开启，计时也随之开始。当主进程执行5005毫秒时，<code class="highlighter-rouge">setTimeout</code>的计时已经结束（5000毫秒），所以当主进程结束时，<code class="highlighter-rouge">setTimeout</code>中<code class="highlighter-rouge">function timer()</code>的执行结果瞬间被弹出，不需等待。</p>

<p>由于for循环中用let声明循环变量i，所以每一次循环都会形成一个scope（{}），此外每次循环中的<code class="highlighter-rouge">function timer()</code>都调用当前enclosing scope中的变量i，所以每个<code class="highlighter-rouge">function timer()</code>都生成了存有当时变量i的closure，所以最后输出1，2，3，4，5</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">count</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="na">cool</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">count</span><span class="p">)},</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">cool</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'jojio'</span><span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span></code></pre></figure>

<p>目的：理解setTimeout函数及参数（函数）的执行时间</p>

<p>由于<code class="highlighter-rouge">setTimeout</code>中的function参数在主进程全部执行完毕后才开始执行，所以执行到<code class="highlighter-rouge">console.log('jojio'+obj.count)</code>时，<code class="highlighter-rouge">function()</code>的<code class="highlighter-rouge">self.count++</code>操作尚未执行,所以obj.count的值为没有被修改，仍为0。当程<code class="highlighter-rouge">console.log('jojio'+obj.count)</code>执行完毕输出“jojio0”后，<code class="highlighter-rouge">setTimeout</code>中<code class="highlighter-rouge">function()</code>开始执行，执行<code class="highlighter-rouge">self.count++</code>时将ojb.count修改成1，然后输出。</p>

            </article>
        </div>
      </div>
      <div class="panel docs-content">
        <article class="post-content">
          <!-- <div class="wrapper">
            


  <div class="ds-thread" data-thread-key="/2016/12/19/book2/" data-title="book2" data-url="http://localhost:4000/2016/12/19/book2/"></div>

<script type="text/javascript">
var duoshuoQuery = {short_name:"bear2prince"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>


 
          </div> -->
        </article>
      </div>
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<p class="copyright">Copyright &copy; 2014-2016 <a href="https://bear2prince.github.io"><code>bear2prince</code></a>.</p>
		<p>Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme from <a href="http://lesscss.cn/">Less</a></p>
	</div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/application.js"></script>
<script src="/styles/js/lessismore.js"></script>


  </body>
</html>
